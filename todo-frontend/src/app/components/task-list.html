<div class="container-fluid p-0">
  <div class="task-app">
    <div class="app-header">
      <h1 class="app-title">All Tasks</h1>
    </div>
    @if (error()) {
    <div class="alert alert-danger alert-dismissible fade show mx-3" role="alert">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      {{ error() }}
      <button type="button" class="btn-close" (click)="error.set(null)"></button>
    </div>
    }
    <div class="task-list-section">
      @if (isLoading() && tasks().length === 0) {
      <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
      } @if (!isLoading() && tasks().length === 0) {
      <div class="empty-state">
        <i class="bi bi-inbox display-1 text-muted"></i>
        <p class="text-muted mt-3">No tasks yet</p>
      </div>
      } @if (tasks().length > 0) {
      <div class="tasks-container">
        @for (task of tasks(); track task.id) { @if (editingTaskId() === task.id) {
        <div class="task-item editing">
          <div class="task-edit-content">
            <input
              type="text"
              class="form-control form-control-lg border-0 mb-2"
              [value]="editingTitle()"
              (input)="editingTitle.set($any($event.target).value)"
              placeholder="Task title"
            />
            <textarea
              class="form-control border-0"
              [value]="editingDescription()"
              (input)="editingDescription.set($any($event.target).value)"
              placeholder="Description"
              rows="2"
            ></textarea>
            <div class="d-flex gap-2 mt-2">
              <button class="btn btn-sm btn-primary" (click)="saveEdit(task.id)">Save</button>
              <button class="btn btn-sm btn-secondary" (click)="cancelEdit()">Cancel</button>
            </div>
          </div>
        </div>
        } @else {
        <div class="task-item" [class.completed]="task.isCompleted">
          <div class="task-check">
            <input
              type="checkbox"
              class="form-check-input"
              [id]="'task-' + task.id"
              [checked]="task.isCompleted"
              (change)="toggleTaskCompletion(task)"
            />
          </div>
          <div class="task-content" (click)="!task.isCompleted && startEdit(task)">
            <div class="task-title">{{ task.title }}</div>
            @if (task.description) {
            <div class="task-description">{{ task.description }}</div>
            }
            <div class="task-date">{{ task.createdAt | date : 'dd MMMM yyyy - HH:mm' }}</div>
          </div>
          <div class="task-actions">
            <button class="btn btn-link p-1" (click)="startEdit(task)" title="Edit">
              <i class="bi bi-pencil text-primary"></i>
            </button>
            <button class="btn btn-link p-1" (click)="deleteTask(task.id)" title="Delete">
              <i class="bi bi-trash text-danger"></i>
            </button>
          </div>
        </div>
        } }
      </div>
      }
    </div>
    <div class="add-task-section">
      @if (showAddForm()) {
      <div class="add-task-form">
        <input
          type="text"
          class="form-control border-0 mb-2"
          placeholder="Task title"
          [value]="newTaskTitle()"
          (input)="newTaskTitle.set($any($event.target).value)"
          (keyup.enter)="addTask()"
          autofocus
        />
        <textarea
          class="form-control border-0 mb-2"
          placeholder="Description (optional)"
          [value]="newTaskDescription()"
          (input)="newTaskDescription.set($any($event.target).value)"
          rows="2"
        ></textarea>
        <div class="d-flex gap-2">
          <button
            class="btn btn-sm btn-primary"
            (click)="addTask()"
            [disabled]="!newTaskTitle().trim()"
          >
            Add Task
          </button>
          <button class="btn btn-sm btn-secondary" (click)="cancelAddTask()">Cancel</button>
        </div>
      </div>
      } @else {
      <div class="add-task-input" (click)="openAddForm()">
        <i class="bi bi-plus-circle text-primary"></i>
        <span class="text-muted">Add a new task...</span>
      </div>
      }
    </div>
  </div>
</div>
